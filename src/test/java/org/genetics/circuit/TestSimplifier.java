package org.genetics.circuit;

import org.genetics.circuit.circuit.CircuitContextDecorator;
import org.genetics.circuit.circuit.CircuitImpl;
import org.genetics.circuit.circuit.CircuitRandomGenerator;
import org.genetics.circuit.configuration.Configuration;
import org.genetics.circuit.entity.SuiteWrapper;
import org.genetics.circuit.problem.Suite;
import org.genetics.circuit.utils.CircuitUtils;
import org.genetics.circuit.utils.IoUtils;
import org.genetics.circuit.utils.SuiteWrapperUtil;
import org.junit.Test;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import static org.hamcrest.CoreMatchers.equalTo;
import static org.hamcrest.MatcherAssert.assertThat;


public class TestSimplifier {

    public static final Logger logger = LoggerFactory.getLogger(TestSimplifier.class);

    @Test
    public void testSimplifier() {
        CircuitImpl circuitImpl = IoUtils.base64ToObject("rO0ABXNyAChvcmcuZ2VuZXRpY3MuY2lyY3VpdC5jaXJjdWl0LkNpcmN1aXRJbXBsAAAAAAAAAAECAAB4cgATamF2YS51dGlsLkFycmF5TGlzdHiB0h2Zx2GdAwABSQAEc2l6ZXhwAAACFXcEAAACFXNyACNvcmcuZ2VuZXRpY3MuY2lyY3VpdC5wb3J0LlBvcnRJbnB1dAAAAAAAAAABAgABSQAFaW5kZXh4cgAeb3JnLmdlbmV0aWNzLmNpcmN1aXQucG9ydC5Qb3J0AAAAAAAAAAECAAB4cAAAAABzcQB-AAMAAAABc3EAfgADAAAAAnNxAH4AAwAAAANzcQB-AAMAAAAEc3EAfgADAAAABXNxAH4AAwAAAAZzcQB-AAMAAAAHc3EAfgADAAAACHNxAH4AAwAAAAlzcQB-AAMAAAAKc3EAfgADAAAAC3NyACBvcmcuZ2VuZXRpY3MuY2lyY3VpdC5wb3J0LlBvcnRPcgAAAAAAAAABAgACSQAFbWFqb3JJAAVtaW5vcnhxAH4ABAAAAAYAAAADc3EAfgARAAAAAQAAAABzcgAhb3JnLmdlbmV0aWNzLmNpcmN1aXQucG9ydC5Qb3J0Tm9yAAAAAAAAAAECAAJJAAVtYWpvckkABW1pbm9yeHEAfgAEAAAADAAAAApzcQB-ABEAAAADAAAAAXNxAH4AEQAAAAwAAAAKc3EAfgAUAAAACwAAAAdzcgAhb3JnLmdlbmV0aWNzLmNpcmN1aXQucG9ydC5Qb3J0Tm90AAAAAAAAAAECAAFJAAVpbmRleHhxAH4ABAAAAABzcQB-ABQAAAAIAAAAA3NxAH4AFAAAAA8AAAACc3EAfgAZAAAACXNxAH4AEQAAABQAAAALc3EAfgAUAAAAFAAAAAZzcgAsb3JnLmdlbmV0aWNzLmNpcmN1aXQucG9ydC5Qb3J0TWVtb3J5U2V0UmVzZXQAAAAAAAAAAQIAA0kABW1ham9ySQAFbWlub3JJAAR0eXBleHEAfgAEAAAAEgAAAAAAAAAAc3EAfgARAAAAGAAAAARzcQB-ABEAAAAWAAAAEnNyACFvcmcuZ2VuZXRpY3MuY2lyY3VpdC5wb3J0LlBvcnRBbmQAAAAAAAAAAQIAAkkABW1ham9ySQAFbWlub3J4cQB-AAQAAAARAAAAAXNxAH4AJAAAABcAAAABc3EAfgARAAAAGwAAAABzcgAib3JnLmdlbmV0aWNzLmNpcmN1aXQucG9ydC5Qb3J0TmFuZAAAAAAAAAABAgACSQAFbWFqb3JJAAVtaW5vcnhxAH4ABAAAABIAAAAMc3EAfgAoAAAAFgAAAARzcQB-ACQAAAAJAAAABnNxAH4AIAAAABMAAAAHAAAAAXNxAH4AEQAAAB8AAAALc3EAfgARAAAABQAAAARzcQB-ACQAAAAcAAAAAnNxAH4AFAAAABwAAAAAc3EAfgAUAAAAIAAAAB9zcQB-ACgAAAAPAAAAAXNxAH4AEQAAAA4AAAACc3EAfgAZAAAAEHNxAH4AIAAAACkAAAAWAAAAAXNxAH4AGQAAACpzcQB-ACAAAAALAAAACgAAAABzcQB-ACQAAAATAAAACXNxAH4AEQAAABoAAAAVc3EAfgAgAAAALAAAACYAAAAAc3EAfgAUAAAAFQAAAAdzcQB-ABEAAAAoAAAADXNxAH4AJAAAACcAAAAGc3EAfgAZAAAAIHNxAH4AFAAAAB0AAAAYc3EAfgAkAAAAKgAAAB5zcQB-ACAAAAApAAAAHQAAAABzcQB-ACAAAAANAAAAAQAAAAFzcQB-ABEAAAAdAAAACXNxAH4AKAAAACoAAAAVc3EAfgAgAAAAHgAAABQAAAABc3EAfgAUAAAAOAAAABVzcQB-ACAAAAA7AAAAEwAAAAFzcQB-ABkAAAA3c3EAfgARAAAALQAAAB5zcQB-ACgAAAAWAAAACnNxAH4AJAAAABEAAAAIc3EAfgAgAAAAPwAAAAAAAAAAc3EAfgAUAAAAGAAAAApzcQB-ACQAAAAPAAAABXNxAH4AFAAAADEAAAAVc3EAfgAUAAAAPQAAABxzcQB-ACQAAAAUAAAAA3NxAH4AGQAAACxzcQB-ACAAAABEAAAAMQAAAABzcQB-ABkAAAAwc3EAfgAgAAAAQAAAAAQAAAABc3EAfgARAAAAJQAAAA9zcQB-ABQAAAAxAAAALXNxAH4AFAAAADwAAAAac3EAfgAUAAAAKgAAACZzcQB-ABEAAAA5AAAAOHNxAH4AIAAAACsAAAADAAAAAXNxAH4AIAAAAEEAAAAVAAAAAXNxAH4AGQAAADVzcQB-ABEAAAApAAAAI3NxAH4AIAAAADoAAAAjAAAAAXNxAH4AKAAAAEQAAAAXc3EAfgAoAAAAPwAAAApzcQB-ACgAAAAqAAAAFXNxAH4AIAAAADsAAAAbAAAAAXNxAH4AGQAAABFzcQB-ABkAAAAcc3EAfgAUAAAAVgAAAEFzcQB-ACQAAABMAAAAAnNxAH4AKAAAAFMAAAADc3EAfgAgAAAAUgAAAEUAAAAAc3EAfgAZAAAAB3NxAH4AKAAAAFMAAAAlc3EAfgAoAAAASAAAAAFzcQB-ABQAAABhAAAAV3NxAH4AJAAAAFcAAAAPc3EAfgAUAAAAMwAAACJzcQB-ACAAAAAdAAAAAQAAAABzcQB-ABEAAAAWAAAABnNxAH4AGQAAADdzcQB-ACgAAABnAAAAWHNxAH4AEQAAAGQAAABZc3EAfgAUAAAAXQAAADBzcQB-ACgAAAAiAAAAEXNxAH4AGQAAADZzcQB-ABQAAABYAAAAInNxAH4AKAAAAFMAAABLc3EAfgARAAAAbgAAAENzcQB-ABEAAABlAAAARXNxAH4AKAAAAE0AAAA9c3EAfgAgAAAAVwAAACYAAAAAc3EAfgAoAAAAWgAAAD5zcQB-ACgAAABGAAAAOHNxAH4AEQAAACsAAAAGc3EAfgARAAAAWQAAADhzcQB-ACgAAABVAAAAQnNxAH4AFAAAAFwAAAAcc3EAfgAZAAAAW3NxAH4AKAAAAEUAAAA1c3EAfgAUAAAAeQAAADRzcQB-ABEAAAByAAAAJ3NxAH4AJAAAAEYAAAAQc3EAfgAkAAAAdQAAAHBzcQB-ABkAAAAhc3EAfgAZAAAAC3NxAH4AEQAAAGwAAAAgc3EAfgAoAAAAcgAAAE1zcQB-ABkAAAB2c3EAfgAUAAAAWAAAACRzcQB-ABEAAABlAAAATHNxAH4AJAAAAD8AAAAOc3EAfgAkAAAAXAAAAFhzcQB-ABEAAABjAAAAM3NxAH4AEQAAAGkAAAAtc3EAfgARAAAAaQAAADtzcQB-ACAAAAB3AAAAAAAAAABzcQB-ABkAAABdc3EAfgAgAAAAgAAAABYAAAABc3EAfgAkAAAAggAAAFtzcQB-ABQAAABUAAAAMHNxAH4AFAAAAFQAAABFc3EAfgAoAAAAUwAAAE5zcQB-ACQAAACEAAAARXNxAH4AKAAAACcAAAAbc3EAfgARAAAALgAAACNzcQB-ACgAAACMAAAAgXNxAH4AEQAAAG8AAAAkc3EAfgARAAAAWwAAAEFzcQB-ACgAAAB3AAAAHHNxAH4AGQAAAIhzcQB-ABQAAABfAAAAF3NxAH4AJAAAAG0AAABcc3EAfgAZAAAAHnNxAH4AKAAAAIEAAAB2c3EAfgAZAAAAGHNxAH4AGQAAAJ5zcQB-ACAAAAAsAAAAHAAAAABzcQB-ABQAAABMAAAAEXNxAH4AIAAAAJkAAAA4AAAAAXNxAH4AJAAAAEYAAAArc3EAfgAZAAAAP3NxAH4AEQAAADwAAAAuc3EAfgAUAAAANQAAABtzcQB-ABQAAABQAAAAE3NxAH4AFAAAAHkAAAAac3EAfgAgAAAAeAAAAB8AAAAAc3EAfgAZAAAAnnNxAH4AIAAAABUAAAABAAAAAXNxAH4AFAAAAJYAAAAAc3EAfgAUAAAAWwAAAENzcQB-ACAAAABRAAAATQAAAAFzcQB-ABkAAAA9c3EAfgAoAAAApwAAAB5zcQB-ACgAAAA-AAAAAXNxAH4AKAAAACgAAAAcc3EAfgAoAAAAggAAAHpzcQB-ACAAAABiAAAADwAAAAFzcQB-ABkAAABlc3EAfgAUAAAAogAAAHBzcQB-ABEAAAC1AAAAsXNxAH4AJAAAAH0AAAAGc3EAfgAUAAAAswAAAJxzcQB-ACAAAACzAAAAQAAAAABzcQB-ABkAAABjc3EAfgAkAAAAfAAAAEhzcQB-ACgAAAClAAAAiXNxAH4AKAAAAGQAAABXc3EAfgAkAAAARQAAAD9zcQB-ABkAAAAgc3EAfgAUAAAAaAAAADxzcQB-ABQAAABYAAAAJnNxAH4AJAAAAJcAAABbc3EAfgARAAAAlgAAAD5zcQB-ACAAAABcAAAAJgAAAABzcQB-ABkAAABYc3EAfgAoAAAAkQAAAFlzcQB-ABEAAACgAAAAfXNxAH4AEQAAAC8AAAAtc3EAfgAZAAAAn3NxAH4AIAAAAKcAAACdAAAAAHNxAH4AIAAAAHAAAAAsAAAAAHNxAH4AKAAAAKIAAAANc3EAfgAZAAAAV3NxAH4AJAAAAMcAAAArc3EAfgARAAAAmwAAAI5zcQB-ACAAAACpAAAAMgAAAAFzcQB-ABkAAAB3c3EAfgAgAAAAYgAAACQAAAAAc3EAfgARAAAAYwAAABVzcQB-ABEAAACQAAAAj3NxAH4AGQAAAGpzcQB-ABQAAACgAAAAe3NxAH4AGQAAAGVzcQB-ABEAAABFAAAAKHNxAH4AFAAAAKMAAAAJc3EAfgAZAAAAfnNxAH4AGQAAAGBzcQB-ACgAAAC9AAAAR3NxAH4AFAAAAEYAAAAtc3EAfgAkAAAAfQAAAABzcQB-ACgAAACNAAAAPnNxAH4AKAAAAH0AAAANc3EAfgARAAAABQAAAAFzcQB-ABEAAADaAAAAiHNxAH4AFAAAAE8AAAAkc3EAfgAgAAAA2wAAAE0AAAAAc3EAfgAkAAAAlQAAAA1zcQB-ACAAAACUAAAAKwAAAAFzcQB-ABQAAACzAAAAa3NxAH4AEQAAALkAAABCc3EAfgAZAAAAP3NxAH4AIAAAALwAAACZAAAAAHNxAH4AEQAAAK4AAABTc3EAfgAZAAAA0XNxAH4AIAAAAMcAAAA8AAAAAHNxAH4AEQAAAKIAAACUc3EAfgAkAAAAfwAAAClzcQB-ABEAAACoAAAAdnNxAH4AFAAAAO8AAAA2c3EAfgAoAAAA1QAAAJ9zcQB-ACgAAADIAAAAaXNxAH4AEQAAAIgAAABfc3EAfgAgAAAA1QAAAGkAAAABc3EAfgAUAAAAzgAAAH9zcQB-ACQAAACIAAAAPXNxAH4AFAAAALsAAABEc3EAfgAgAAAA3wAAANoAAAABc3EAfgARAAAA0AAAADxzcQB-ABQAAAC2AAAAfXNxAH4AEQAAAKAAAAAsc3EAfgAoAAAAyAAAACdzcQB-ACQAAADcAAAAMHNxAH4AKAAAAL8AAAAgc3EAfgAgAAAAfwAAAA0AAAAAc3EAfgAgAAAA-gAAAKsAAAABc3EAfgAkAAAAggAAABVzcQB-ACgAAADqAAAAn3NxAH4AFAAAANkAAACWc3EAfgAUAAAAngAAADZzcQB-ABkAAACIc3EAfgAgAAAAQgAAAA0AAAABc3EAfgAoAAAA4wAAANZzcQB-ABkAAADjc3EAfgAoAAABCAAAAKZzcQB-ACQAAADgAAAAzXNxAH4AEQAAAK4AAAAgc3EAfgAZAAAA7nNxAH4AFAAAAH8AAAA-c3EAfgAZAAAAkXNxAH4AFAAAAKYAAACcc3EAfgARAAAA6AAAAHVzcQB-ABEAAAArAAAAHXNxAH4AIAAAAGgAAAATAAAAAHNxAH4AGQAAAEVzcQB-ABQAAAD2AAAAlHNxAH4AIAAAAPsAAADEAAAAAHNxAH4AJAAAAOIAAAAKc3EAfgAUAAABEQAAANdzcQB-ACgAAAEKAAAABnNxAH4AGQAAACVzcQB-ACAAAAEYAAAAaAAAAABzcQB-ACgAAAEEAAAAwXNxAH4AKAAAAPgAAACRc3EAfgAZAAAAUHNxAH4AIAAAAJAAAAASAAAAAXNxAH4AFAAAARIAAADac3EAfgAUAAAARAAAAC1zcQB-ABkAAACrc3EAfgARAAABHAAAALJzcQB-ACQAAADhAAAAVXNxAH4AEQAAAAIAAAABc3EAfgAZAAAAhHNxAH4AKAAAAJ8AAABCc3EAfgAUAAAAdwAAACdzcQB-ABkAAADOc3EAfgAUAAAA-gAAADZzcQB-ACAAAAD9AAAArwAAAAFzcQB-ACgAAADpAAAABnNxAH4AKAAAAM8AAABwc3EAfgAUAAAA8gAAALVzcQB-ACQAAADMAAAAaHNxAH4AGQAAASFzcQB-ACgAAAElAAAAEXNxAH4AFAAAALoAAABAc3EAfgAoAAABLQAAACtzcQB-ABQAAAExAAAAlHNxAH4AFAAAAMkAAACQc3EAfgARAAAAnwAAABpzcQB-ACgAAACyAAAAQnNxAH4AJAAAAOcAAACxc3EAfgARAAAA7gAAAEVzcQB-ACAAAADEAAAAJAAAAAFzcQB-ABEAAAEXAAAAmHNxAH4AJAAAAFgAAABJc3EAfgAkAAAAnAAAAGpzcQB-ACQAAADVAAAAKnNxAH4AJAAAASwAAAD6c3EAfgAgAAAATgAAAAcAAAABc3EAfgAUAAABKwAAAK1zcQB-ABEAAAEZAAAAZHNxAH4AIAAAAPwAAADqAAAAAHNxAH4AGQAAARRzcQB-ABQAAACRAAAAJXNxAH4AEQAAARYAAAAoc3EAfgAgAAAAqAAAAIQAAAAAc3EAfgAUAAAAlQAAAH9zcQB-ACgAAADuAAAA13NxAH4AEQAAAOEAAABGc3EAfgAgAAABNAAAAKQAAAAAc3EAfgAZAAAAlHNxAH4AEQAAAOAAAADRc3EAfgAZAAABRHNxAH4AFAAAAPUAAACEc3EAfgAgAAABBAAAAJAAAAAAc3EAfgAoAAAA_gAAAA5zcQB-ACgAAAFQAAAAs3NxAH4AFAAAAOkAAAC0c3EAfgAZAAAAWHNxAH4AIAAAASUAAAChAAAAAHNxAH4AEQAAAPwAAABpc3EAfgAgAAABGgAAAJ0AAAABc3EAfgAZAAABAnNxAH4AJAAAAHIAAAAdc3EAfgAoAAABEwAAABJzcQB-ACgAAABuAAAAP3NxAH4AIAAAALEAAAATAAAAAXNxAH4AGQAAABdzcQB-ACgAAACHAAAAFnNxAH4AEQAAAOIAAADec3EAfgAoAAABOQAAAEpzcQB-ACAAAACXAAAAcgAAAAFzcQB-ABQAAAD9AAAAgXNxAH4AIAAAAQcAAABxAAAAAHNxAH4AGQAAAKhzcQB-ABkAAAEVc3EAfgAoAAAA6AAAAGNzcQB-ACQAAADKAAAAaHNxAH4AJAAAAVoAAAEsc3EAfgAkAAABTQAAARNzcQB-ABkAAAAec3EAfgAoAAAAfwAAAF5zcQB-ACQAAAEKAAAAtnNxAH4AEQAAASAAAADAc3EAfgAoAAABbAAAANxzcQB-ACAAAAFJAAABAgAAAAFzcQB-ABkAAAEFc3EAfgAoAAABDAAAAIdzcQB-ABQAAAFiAAAAkHNxAH4AGQAAAIZzcQB-ABQAAAC5AAAAXXNxAH4AKAAAAQYAAADNc3EAfgARAAABdAAAAAlzcQB-ACQAAADfAAAAqnNxAH4AGQAAASFzcQB-ACgAAAD1AAAAs3NxAH4AGQAAAOBzcQB-ACQAAAF4AAAADHNxAH4AKAAAAV4AAACkc3EAfgARAAABXAAAAJtzcQB-ABEAAAFnAAABNXNxAH4AKAAAATIAAABHc3EAfgAUAAABdQAAADpzcQB-ABQAAAF4AAABJXNxAH4AKAAAAPgAAAD3c3EAfgAkAAABUgAAALhzcQB-ACgAAAFHAAAAGXNxAH4AIAAAAKAAAAAqAAAAAHNxAH4AFAAAAP0AAACac3EAfgARAAABSAAAADNzcQB-ACgAAACWAAAAFXNxAH4AGQAAAU9zcQB-ACQAAAFsAAAAtHNxAH4AGQAAALJzcQB-ABEAAAFwAAABDHNxAH4AJAAAAYQAAAF5c3EAfgARAAABjgAAAFZzcQB-ACgAAADyAAAAV3NxAH4AIAAAAN0AAABUAAAAAXNxAH4AJAAAAK4AAACXc3EAfgAkAAABjQAAAXJzcQB-ACAAAAGSAAAA2QAAAAFzcQB-ABQAAAEEAAAArXNxAH4AJAAAAQEAAADVc3EAfgARAAAA8gAAAIVzcQB-ABkAAAB1c3EAfgAgAAABOQAAAHUAAAAAc3EAfgAkAAAAygAAAC5zcQB-ABkAAACec3EAfgAZAAAAeHNxAH4AEQAAAEgAAAAqc3EAfgAUAAABQgAAABpzcQB-ACgAAADIAAAAMHNxAH4AIAAAAQ0AAABlAAAAAXNxAH4AJAAAASAAAAC7c3EAfgARAAABNwAAAAlzcQB-ABkAAAAOc3EAfgAZAAAAP3NxAH4AGQAAAW5zcQB-ABQAAAFBAAAAanNxAH4AKAAAAJUAAAAvc3EAfgARAAABkwAAASpzcQB-ABQAAAGaAAABBHNxAH4AEQAAAYsAAAFLc3EAfgAZAAABMHNxAH4AEQAAANYAAABVc3EAfgARAAABIAAAAPlzcQB-ACAAAADrAAAAqAAAAAFzcQB-ABkAAABzc3EAfgAgAAAAdQAAAGYAAAAAc3EAfgAkAAABDQAAAKxzcQB-ACQAAAEmAAAA0HNxAH4AIAAAAHgAAABJAAAAAHNxAH4AIAAAAHkAAAAPAAAAAHNxAH4AFAAAARcAAABRc3EAfgARAAAAIwAAAA9zcQB-ACgAAAETAAAAYnNxAH4AKAAAAVEAAADjc3EAfgAUAAABtgAAADtzcQB-ACAAAAFRAAAAogAAAAFzcQB-ABEAAAEpAAABKHNxAH4AGQAAADhzcQB-ABQAAADLAAAAK3NxAH4AKAAAALkAAABOc3EAfgAgAAABZgAAATEAAAABc3EAfgAoAAABRAAAALhzcQB-ABkAAAA5c3EAfgAkAAABAAAAABBzcQB-ABkAAACmc3EAfgAoAAABjQAAABlzcQB-ACQAAAFoAAAAKXNxAH4AKAAAALsAAACGc3EAfgARAAABSwAAAHBzcQB-ABEAAADSAAAApXNxAH4AJAAAAGAAAABVc3EAfgAgAAABxwAAAMIAAAAAc3EAfgAgAAAAyQAAAGwAAAAAc3EAfgAoAAAAwQAAAHVzcQB-ACgAAAHBAAABa3NxAH4AIAAAAToAAAEdAAAAAXNxAH4AFAAAAEMAAAAcc3EAfgAoAAABpAAAALZzcQB-ABEAAAGDAAABQnNxAH4AIAAAAJIAAAASAAAAAXNxAH4AJAAAASQAAADdc3EAfgAZAAAA4nNxAH4AKAAAAcMAAABUc3EAfgAkAAAA5gAAAFZzcQB-ABkAAAFQc3EAfgAZAAABsnNxAH4AKAAAAC8AAAASc3EAfgAoAAAA2gAAALBzcQB-ABEAAAEoAAAAq3NxAH4AJAAAAJsAAABjc3EAfgAUAAAA-wAAANRzcQB-ABEAAAFKAAABSHNxAH4AEQAAAb8AAAEsc3EAfgAUAAABggAAAIpzcQB-ABkAAAEic3EAfgAoAAAAowAAABlzcQB-ACQAAACJAAAAd3NxAH4AJAAAAcAAAACic3EAfgAUAAAA7gAAAJVzcQB-ABQAAADrAAAARXNxAH4AKAAAAScAAAEdc3EAfgAkAAABKAAAAOxzcQB-ABEAAAE0AAAAcHNxAH4AIAAAARQAAABkAAAAAHNxAH4AJAAAAHkAAABFc3EAfgAUAAABuAAAABRzcQB-ACQAAAHdAAAAf3NxAH4AIAAAAO0AAAC0AAAAAHNxAH4AKAAAAasAAACxc3EAfgARAAAB3gAAAIdzcQB-ACQAAAHMAAAAr3NxAH4AIAAAAHoAAAALAAAAAXNxAH4AFAAAAQgAAADgc3EAfgAZAAAAEnNxAH4AFAAAAa4AAAFvc3EAfgARAAABgwAAAL1zcQB-ABQAAAE0AAAA-HNxAH4AKAAAAU8AAAAac3EAfgAUAAAB6QAAAQtzcQB-ABkAAAHZc3EAfgAUAAAA2wAAABtzcQB-ACAAAAGIAAABOQAAAAFzcQB-ACQAAAGSAAAADXNxAH4AGQAAAZ5zcQB-ACAAAADXAAAANwAAAABzcQB-ACAAAAEjAAAAIwAAAAFzcQB-ABkAAAC9c3EAfgAUAAAAfgAAAFtzcQB-ABEAAAFJAAAAkHNxAH4AKAAAAQgAAACfc3EAfgAUAAABkwAAAUpzcQB-ABkAAABSc3EAfgARAAAB4AAAAN9zcQB-ACgAAAHIAAABrHNxAH4AEQAAAZwAAADMc3EAfgAgAAABhAAAADwAAAABc3EAfgAgAAABhgAAAOwAAAABc3EAfgAUAAABUAAAAPtzcQB-ACgAAAGkAAAAm3NxAH4AGQAAAQZzcQB-ACAAAAGrAAAAfwAAAAFzcQB-ABEAAADpAAAA43NxAH4AKAAAAasAAAD6c3EAfgAZAAABdnNxAH4AGQAAAeVzcQB-ACAAAAHVAAAAhwAAAAB4", CircuitImpl.class);
        Suite suite = IoUtils.base64ToObject("rO0ABXNyAC1vcmcuZ2VuZXRpY3MuY2lyY3VpdC5wcm9ibGVtLnZvd2VsLlZvd2VsU3VpdGUAAAAAAAAAAQIAAkwACWV2YWx1YXRvcnQAKExvcmcvZ2VuZXRpY3MvY2lyY3VpdC9wcm9ibGVtL0V2YWx1YXRvcjtMAAt0cmFpbmluZ1NldHQAKkxvcmcvZ2VuZXRpY3MvY2lyY3VpdC9wcm9ibGVtL1RyYWluaW5nU2V0O3hwc3IAMW9yZy5nZW5ldGljcy5jaXJjdWl0LnByb2JsZW0udm93ZWwuVm93ZWxFdmFsdWF0b3IAAAAAAAAAAQIAAHhwc3IAM29yZy5nZW5ldGljcy5jaXJjdWl0LnByb2JsZW0udm93ZWwuVm93ZWxUcmFpbmluZ1NldAAAAAAAAAABAgADSQAJaW5wdXRTaXplSQAKb3V0cHV0U2l6ZUwACXNvbHV0aW9uc3QAEExqYXZhL3V0aWwvTGlzdDt4cAAAAAwAAAAJc3IAE2phdmEudXRpbC5BcnJheUxpc3R4gdIdmcdhnQMAAUkABHNpemV4cAAAAAZ3BAAAAAZzcgAsb3JnLmdlbmV0aWNzLmNpcmN1aXQuc29sdXRpb24uU3RyaW5nU29sdXRpb24AAAAAAAAAAQIAAHhyACZvcmcuZ2VuZXRpY3MuY2lyY3VpdC5zb2x1dGlvbi5Tb2x1dGlvbgAAAAAAAAABAgAAeHEAfgAJAAAAB3cEAAAAB3NyACdvcmcuZ2VuZXRpY3MuY2lyY3VpdC5zb2x1dGlvbi5UaW1lU2xpY2UAAAAAAAAAAQIAAlsABWlucHV0dAACW1pbAAZvdXRwdXRxAH4AD3hwdXIAAltaV48gORS4XeICAAB4cAAAAAwAAQEAAAAAAQABAAF1cQB-ABEAAAAJAAAAAAAAAAAAc3EAfgAOdXEAfgARAAAADAAAAAAAAAAAAQEAAHVxAH4AEQAAAAkAAQEBAAEBAAFzcQB-AA51cQB-ABEAAAAMAAAAAAAAAAAAAQAAdXEAfgARAAAACQABAQABAQEBAXNxAH4ADnVxAH4AEQAAAAwAAAAAAAAAAAEBAAB1cQB-ABEAAAAJAAEBAAABAQEBc3EAfgAOdXEAfgARAAAADAAAAAAAAAAAAAEAAHVxAH4AEQAAAAkAAQEAAAAAAQFzcQB-AA51cQB-ABEAAAAMAAAAAAAAAAABAQAAdXEAfgARAAAACQABAQABAQAAAXNxAH4ADnVxAH4AEQAAAAwAAAAAAAAAAAABAAB1cQB-ABEAAAAJAAAAAAAAAAAAeHNxAH4ACwAAAAt3BAAAAAtzcQB-AA51cQB-ABEAAAAMAAEBAAAAAQAAAQABdXEAfgARAAAACQAAAAAAAAAAAHNxAH4ADnVxAH4AEQAAAAwAAAAAAAAAAAEBAAB1cQB-ABEAAAAJAAEBAAAAAQEBc3EAfgAOdXEAfgARAAAADAAAAAAAAAAAAAEAAHVxAH4AEQAAAAkAAQEAAQEBAQFzcQB-AA51cQB-ABEAAAAMAAAAAAAAAAABAQAAdXEAfgARAAAACQABAQABAQEAAXNxAH4ADnVxAH4AEQAAAAwAAAAAAAAAAAABAAB1cQB-ABEAAAAJAAEBAQAAAQEBc3EAfgAOdXEAfgARAAAADAAAAAAAAAAAAQEAAHVxAH4AEQAAAAkAAQEAAQEBAQFzcQB-AA51cQB-ABEAAAAMAAAAAAAAAAAAAQAAdXEAfgARAAAACQABAQAAAAABAXNxAH4ADnVxAH4AEQAAAAwAAAAAAAAAAAEBAAB1cQB-ABEAAAAJAAEBAAEBAQABc3EAfgAOdXEAfgARAAAADAAAAAAAAAAAAAEAAHVxAH4AEQAAAAkAAQEBAAEAAAFzcQB-AA51cQB-ABEAAAAMAAAAAAAAAAABAQAAdXEAfgARAAAACQABAQAAAQABAXNxAH4ADnVxAH4AEQAAAAwAAAAAAAAAAAABAAB1cQB-ABEAAAAJAAAAAAAAAAAAeHNxAH4ACwAAAAd3BAAAAAdzcQB-AA51cQB-ABEAAAAMAAEAAAAAAAEAAQABdXEAfgARAAAACQAAAAAAAAAAAHNxAH4ADnVxAH4AEQAAAAwAAAAAAAAAAAEBAAB1cQB-ABEAAAAJAAEBAQABAQABc3EAfgAOdXEAfgARAAAADAAAAAAAAAAAAAEAAHVxAH4AEQAAAAkAAQEAAQEBAQFzcQB-AA51cQB-ABEAAAAMAAAAAAAAAAABAQAAdXEAfgARAAAACQABAQAAAQEBAXNxAH4ADnVxAH4AEQAAAAwAAAAAAAAAAAABAAB1cQB-ABEAAAAJAAEBAAAAAAEBc3EAfgAOdXEAfgARAAAADAAAAAAAAAAAAQEAAHVxAH4AEQAAAAkAAQEAAQEAAAFzcQB-AA51cQB-ABEAAAAMAAAAAAAAAAAAAQAAdXEAfgARAAAACQAAAAAAAAAAAHhzcQB-AAsAAAALdwQAAAALc3EAfgAOdXEAfgARAAAADAABAAAAAAEAAAEAAXVxAH4AEQAAAAkAAAAAAAAAAABzcQB-AA51cQB-ABEAAAAMAAAAAAAAAAABAQAAdXEAfgARAAAACQABAQAAAAEBAXNxAH4ADnVxAH4AEQAAAAwAAAAAAAAAAAABAAB1cQB-ABEAAAAJAAEBAAEBAQEBc3EAfgAOdXEAfgARAAAADAAAAAAAAAAAAQEAAHVxAH4AEQAAAAkAAQEAAQEBAAFzcQB-AA51cQB-ABEAAAAMAAAAAAAAAAAAAQAAdXEAfgARAAAACQABAQEAAAEBAXNxAH4ADnVxAH4AEQAAAAwAAAAAAAAAAAEBAAB1cQB-ABEAAAAJAAEBAAEBAQEBc3EAfgAOdXEAfgARAAAADAAAAAAAAAAAAAEAAHVxAH4AEQAAAAkAAQEAAAAAAQFzcQB-AA51cQB-ABEAAAAMAAAAAAAAAAABAQAAdXEAfgARAAAACQABAQABAQEAAXNxAH4ADnVxAH4AEQAAAAwAAAAAAAAAAAABAAB1cQB-ABEAAAAJAAEBAQABAAABc3EAfgAOdXEAfgARAAAADAAAAAAAAAAAAQEAAHVxAH4AEQAAAAkAAQEAAAEAAQFzcQB-AA51cQB-ABEAAAAMAAAAAAAAAAAAAQAAdXEAfgARAAAACQAAAAAAAAAAAHhzcQB-AAsAAAAJdwQAAAAJc3EAfgAOdXEAfgARAAAADAAAAQEAAAAAAAEAAXVxAH4AEQAAAAkAAAAAAAAAAABzcQB-AA51cQB-ABEAAAAMAAAAAAAAAAABAQAAdXEAfgARAAAACQABAQABAQEAAXNxAH4ADnVxAH4AEQAAAAwAAAAAAAAAAAABAAB1cQB-ABEAAAAJAQEAAAAAAQEBc3EAfgAOdXEAfgARAAAADAAAAAAAAAAAAQEAAHVxAH4AEQAAAAkBAAEBAQABAAFzcQB-AA51cQB-ABEAAAAMAAAAAAAAAAAAAQAAdXEAfgARAAAACQABAQABAQABAXNxAH4ADnVxAH4AEQAAAAwAAAAAAAAAAAEBAAB1cQB-ABEAAAAJAAEBAAABAAEBc3EAfgAOdXEAfgARAAAADAAAAAAAAAAAAAEAAHVxAH4AEQAAAAkAAQEBAAABAAFzcQB-AA51cQB-ABEAAAAMAAAAAAAAAAABAQAAdXEAfgARAAAACQABAQABAQEBAXNxAH4ADnVxAH4AEQAAAAwAAAAAAAAAAAABAAB1cQB-ABEAAAAJAAAAAAAAAAAAeHNxAH4ACwAAAAh3BAAAAAhzcQB-AA51cQB-ABEAAAAMAQEAAAAAAQEAAQABdXEAfgARAAAACQAAAAAAAAAAAHNxAH4ADnVxAH4AEQAAAAwBAAEAAAAAAQEBAAF1cQB-ABEAAAAJAAAAAAAAAAAAc3EAfgAOdXEAfgARAAAADAAAAAAAAAAAAAEAAHVxAH4AEQAAAAkAAQEBAAEBAAFzcQB-AA51cQB-ABEAAAAMAAAAAAAAAAABAQAAdXEAfgARAAAACQABAQABAQEBAXNxAH4ADnVxAH4AEQAAAAwAAAAAAAAAAAABAAB1cQB-ABEAAAAJAAEBAAABAQEBc3EAfgAOdXEAfgARAAAADAAAAAAAAAAAAQEAAHVxAH4AEQAAAAkAAQEAAAAAAQFzcQB-AA51cQB-ABEAAAAMAAAAAAAAAAAAAQAAdXEAfgARAAAACQABAQABAQAAAXNxAH4ADnVxAH4AEQAAAAwAAAAAAAAAAAEBAAB1cQB-ABEAAAAJAAAAAAAAAAAAeHg=", Suite.class);

        SuiteWrapper suiteWrapper = new SuiteWrapper();
        suiteWrapper.setSuite(suite);

        circuitImpl = CircuitRandomGenerator.randomGenerate(SuiteWrapperUtil.getInputSize(suiteWrapper), 500000, true);
        CircuitContextDecorator ccd = new CircuitContextDecorator(circuitImpl);

        ccd.evaluate(suiteWrapper);

        logger.info("Original: " + ccd.toString());

        long inicio = System.currentTimeMillis();

        if (circuitImpl.size() > 3000) { // This is done in better join, but some time it is better to do it first or we can run out of memory
            CircuitUtils.simplifyByRemovingUnsedPorts(suite.getTrainingSet(), circuitImpl);
        }
        CircuitUtils.betterSimplify(suite.getTrainingSet(), circuitImpl);

        logger.info("Took: " + (System.currentTimeMillis() - inicio));

        CircuitContextDecorator ccd1 = new CircuitContextDecorator(circuitImpl);
        ccd1.evaluate(suiteWrapper);
        logger.info("Simplificado: " + ccd1.toString());

    }

    @Test
    public void testTranslation() {
        assertThat(getPosition(1, 2, 1, 0), equalTo(0L));


        assertThat(getPosition(2, 3, 2, 0), equalTo(0L));
        assertThat(getPosition(2, 3, 2, 1), equalTo(1L));

        // *********************************

        assertThat(getPosition(2, 4, 2, 0), equalTo(0L));
        assertThat(getPosition(2, 4, 2, 1), equalTo(1L));

        assertThat(getPosition(2, 4, 3, 0), equalTo(2L));
        assertThat(getPosition(2, 4, 3, 1), equalTo(3L));
        assertThat(getPosition(2, 4, 3, 2), equalTo(4L));

        // *********************************

        assertThat(getPosition(3, 4, 3, 0), equalTo(0L));
        assertThat(getPosition(3, 4, 3, 1), equalTo(1L));
        assertThat(getPosition(3, 4, 3, 2), equalTo(2L));

        // *********************************

        assertThat(getPosition(2, 5, 2, 0), equalTo(0L));
        assertThat(getPosition(2, 5, 2, 1), equalTo(1L));

        assertThat(getPosition(2, 5, 3, 0), equalTo(2L));
        assertThat(getPosition(2, 5, 3, 1), equalTo(3L));
        assertThat(getPosition(2, 5, 3, 2), equalTo(4L));

        assertThat(getPosition(2, 5, 4, 0), equalTo(5L));
        assertThat(getPosition(2, 5, 4, 1), equalTo(6L));
        assertThat(getPosition(2, 5, 4, 2), equalTo(7L));
        assertThat(getPosition(2, 5, 4, 3), equalTo(8L));

        // 44.999.849.908
        // 5.624.981.238
        int t = 300000; // 704.982.612
        System.out.println(getPosition(14, t, t-1, t-2));


    }


    public static long getPosition(int inputSize, int circuitSize, int index, int reference) {
        if (Configuration.CHECK_CONSISTENCY) {
            if (inputSize <= 0)
                throw new RuntimeException("The circuit must have at least one input port");
            if (reference >= index)
                throw new RuntimeException("Relation must be lower than index");
            if (index < inputSize)
                throw new RuntimeException("Cannot check the input port");
            if (index >= circuitSize)
                throw new RuntimeException("Out of range");
            if (circuitSize <= inputSize)
                throw new RuntimeException("The circuit must have at least one non input port");

        }

        int nonInputIndex = index - inputSize;

        long f = (((long)nonInputIndex * ((long)nonInputIndex - 1l)) / 2l);

        return ((long)nonInputIndex * (long)inputSize) + f + ((long) reference);
    }


}
